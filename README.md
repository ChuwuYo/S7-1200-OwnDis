# S7-1200 跑马灯上位机

基于 Go 语言的 S7-1200 PLC 跑马灯控制系统，通过 Modbus TCP 协议实现 PLC 通信与控制。

## 功能特性

- **PLC 连接管理**：自动检测连接状态，支持 IP/端口/Unit ID 配置
- **跑马灯控制**：三挡速度 (1000ms/500ms/200ms)，启停控制，状态实时显示
- **实时监控**：数字输入输出状态监控，环境数据 (温度/湿度) 读取
- **手动控制**：停止状态下手动控制输出点，运行时自动保护
- **配置管理**：自动保存配置，支持参数持久化

## 技术栈

- **语言**：Go 1.24.3
- **通信**：Modbus TCP 协议
- **架构**：Goroutine 并发模型
- **界面**：Web UI

## 项目结构

```
├── main.go           # 程序入口
├── modbus.go         # Modbus TCP 通信
├── web_ui.go         # Web 界面实现
├── marquee.go        # 跑马灯控制逻辑
├── manual.go         # 手动控制逻辑
├── input.go          # 输入状态监控
├── environment.go    # 环境数据读取
├── config.go         # 配置管理
├── config/           # 配置文件目录
└── docs/             # 文档目录
```

## 快速开始

### 环境要求
- Windows 11
- Go 1.24.3+

### 编译运行
```bash
# 编译
go build -o s7-1200-marquee.exe .

# 运行
./s7-1200-marquee.exe
```

### 基本操作
1. 配置 PLC 连接参数 (IP/端口/Unit ID)
2. 点击"连接"建立 PLC 通信
3. 使用"启动/停止"控制跑马灯
4. 通过"速度切换"在三挡间循环
5. 停止状态下可手动控制输出点

### 日志输出
程序启动时会同时在控制台和 `marquee_log.txt` 文件中输出日志信息，便于调试和监控。

## 配置说明

默认配置文件 `config/config.json`：
```json
{
  "ip": "192.168.0.10",
  "port": 502,
  "unitId": 1,
  "speedDelays": [1000, 500, 200],
  "pollIntervalMs": 200
}
```

## PLC 地址映射

| 类型 | 范围 | 功能码 | 说明 |
|------|------|--------|------|
| DQ | Q0.0–Q1.5 | 01/05/15 | 数字输出，跑马灯控制 |
| DI | I0.0–I1.5 | 02 | 数字输入，按钮检测 |
| IW | IW64/IW66 | 04 | 输入寄存器，温湿度数据 |

## 故障排除

- **连接失败**：检查 PLC IP 地址和端口，确认 Modbus TCP 服务正常
- **编译问题**：确保 Go 版本 >= 1.24.3，检查网络连接下载依赖
- **状态不更新**：检查轮询间隔配置，确认 PLC 连接正常

## 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件